-- Define the function to create the border effect
local function createBorder(player)
    -- Create a part to represent the border
    local borderPart = Instance.new("Part")
    borderPart.Size = player.Character.HumanoidRootPart.Size * 1.1
    borderPart.Transparency = 1
    borderPart.Color = Color3.fromRGB(139, 0, 0) -- Dark red color
    borderPart.Anchored = true
    borderPart.CanCollide = false
    borderPart.Position = player.Character.HumanoidRootPart.Position
    borderPart.Parent = workspace

    -- Create a SurfaceGui for the border
    local surfaceGui = Instance.new("SurfaceGui")
    surfaceGui.Face = Enum.NormalId.Back
    surfaceGui.Parent = borderPart

    -- Create a frame inside the SurfaceGui to draw the border
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BorderSizePixel = 0
    frame.BackgroundColor3 = Color3.fromRGB(139, 0, 0) -- Dark red color
    frame.Parent = surfaceGui

    -- Set the part's SurfaceTransparency to 1 so it's visible through other parts
    for _, surface in ipairs(Enum.NormalId:GetEnumItems()) do
        borderPart:SetSurfaceTransparency(surface, 1)
    end

    -- Ensure the borderPart follows the player
    local function updatePosition()
        borderPart.Position = player.Character.HumanoidRootPart.Position
    end

    player.Character.HumanoidRootPart:GetPropertyChangedSignal("Position"):Connect(updatePosition)

    -- Clean up the border when the player leaves the game
    player.CharacterRemoving:Connect(function()
        borderPart:Destroy()
    end)
end

-- Call the function for each player when they spawn
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        createBorder(player)
    end)
    if player.Character then
        createBorder(player)
    end
end)

-- Call the function for existing players
for _, player in ipairs(game.Players:GetPlayers()) do
    player.CharacterAdded:Connect(function(character)
        createBorder(player)
    end)
    if player.Character then
        createBorder(player)
    end
end
